!function(){"use strict";const e="Music_Diver_score.csv";class t{music_id;title;artist;genre;level_easy=0;score_easy=0;status_easy="";rank_easy="";level_normal=0;score_normal=0;status_normal="";rank_normal="";level_hard=0;score_hard=0;status_hard="";rank_hard="";level_extreme=0;score_extreme=0;status_extreme="";rank_extreme="";constructor(e,t,r,s){this.music_id=e,this.title=t,this.artist=r,this.genre=s}}function r(e){return e.epic_count>0?"ALL CRITICAL":e.all_perfect_count>0?"ALL PERFECT":e.full_combo_count>0?"FULL COMBO":e.clear_count>=0?"CLEAR":"FAILED"}function s(e){return e.rank_sss_count>0?"SSS":e.rank_ss_count>0?"SS":e.rank_s_count>0?"S":e.rank_a_count>0?"A":e.rank_b_count>0?"B":e.rank_c_count>0?"C":e.rank_d_count>0?"D":e.rank_e_count>0?"E":""}alert("データ集計を開始します。");const n=function(e,n){let c=[];for(const e of n){const r=new t(e.music_id,e.music_title,e.artist_name,e.genre_name);for(const t of e.chart_data)switch(t.difficulty_id){case 0:r.level_easy=t.level_id+1;break;case 1:r.level_normal=t.level_id+1;break;case 2:r.level_hard=t.level_id+1;break;case 3:r.level_extreme=t.level_id+1}c.push(r)}c.sort(((e,t)=>e.music_id-t.music_id));for(const n of e){let e=c.findIndex((e=>e.music_id===n.music_id));if(-1===e){const r=new t(n.music_id,n.music_title,n.artist_name,n.genre_name);e=c.push(r)-1}switch(n.difficulty_id){case 0:c[e].score_easy=n.score,c[e].status_easy=r(n),c[e].rank_easy=s(n);break;case 1:c[e].score_normal=n.score,c[e].status_normal=r(n),c[e].rank_normal=s(n);break;case 2:c[e].score_hard=n.score,c[e].status_hard=r(n),c[e].rank_hard=s(n);break;case 3:c[e].score_extreme=n.score,c[e].status_extreme=r(n),c[e].rank_extreme=s(n)}}return c}(function(){try{const e=new XMLHttpRequest;return e.open("GET","https://mypage.musicdiver.jp/api/record_result?lang=ja",!1),e.send(),JSON.parse(e.response).response.play_result_list}catch(e){const t="Error: スコアデータの取得に失敗しました。";throw alert(t),Error(t)}}(),function(){try{const e=new XMLHttpRequest;return e.open("GET","https://mypage.musicdiver.jp/api/music?lang=ja",!1),e.send(),JSON.parse(e.response).response.music_list}catch(e){const t="Error: 楽曲データの取得に失敗しました。";throw alert(t),Error(t)}}());!function(t){!function(e){if(0===e.length){const e="Error: 参照データが存在しません。";throw alert(e),Error(e)}}(t),console.info("filename:",e);const r=function(e){const t=Object.keys(e[0]),r=e.map((e=>t.map((t=>e[t]))));let s=[].concat([t],r);console.log(s);let n=function(e){return'"'+(""+e).replace(/"/g,'""')+'"'};return s.map((e=>e.map((e=>n(e))).join(","))).join("\n")}(t);!function(t){const r=new Uint8Array([239,187,191]),s=new Blob([r,t],{type:"text/csv"}),n=(window.URL||window.webkitURL).createObjectURL(s);let c=document.createElement("a");c.download=decodeURI(e),c.href=n,c.type="text/csv",c.click()}(r)}(n)}();
