!function(){"use strict";const e="Music_Diver_score.csv";class r{music_id;title;artist;genre;rating_easy=null;level_easy=null;score_easy=null;status_easy=null;rank_easy=null;rating_normal=null;level_normal=null;score_normal=null;status_normal=null;rank_normal=null;rating_hard=null;level_hard=null;score_hard=null;status_hard=null;rank_hard=null;rating_extreme=null;level_extreme=null;score_extreme=null;status_extreme=null;rank_extreme=null;rating_abyss=null;level_abyss=null;score_abyss=null;status_abyss=null;rank_abyss=null;constructor(e,r,t,s){this.music_id=e,this.title=r,this.artist=t,this.genre=s}}function t(e){return e.epic_count>0?"ALL CRITICAL":e.all_perfect_count>0?"ALL PERFECT":e.full_combo_count>0?"FULL COMBO":e.clear_count>0?"CLEAR":"FAILED"}function s(e){return e.rank_sss_count>0?"SSS":e.rank_ss_count>0?"SS":e.rank_s_count>0?"S":e.rank_a_count>0?"A":e.rank_b_count>0?"B":e.rank_c_count>0?"C":e.rank_d_count>0?"D":e.rank_e_count>0?"E":""}alert("データ集計を開始します。");const n=function(e,n,a){let l=[];for(const e of n){const t=new r(e.music_id,e.music_title,e.artist_name,e.genre_name);for(const r of e.chart_data)switch(r.difficulty_id){case 0:t.level_easy=r.level_id+1;break;case 1:t.level_normal=r.level_id+1;break;case 2:t.level_hard=r.level_id+1;break;case 3:t.level_extreme=r.level_id+1;break;case 4:0!=r.level_id&&4!=r.level_id&&(t.level_abyss=r.level_id+1)}l.push(t)}l.sort(((e,r)=>e.music_id-r.music_id));for(const n of e){let e=l.findIndex((e=>e.music_id===n.music_id));if(-1===e){const t=new r(n.music_id,n.music_title,n.artist_name,n.genre_name);e=l.push(t)-1}switch(n.difficulty_id){case 0:l[e].score_easy=n.score,l[e].status_easy=t(n),l[e].rank_easy=s(n);break;case 1:l[e].score_normal=n.score,l[e].status_normal=t(n),l[e].rank_normal=s(n);break;case 2:l[e].score_hard=n.score,l[e].status_hard=t(n),l[e].rank_hard=s(n);break;case 3:l[e].score_extreme=n.score,l[e].status_extreme=t(n),l[e].rank_extreme=s(n);break;case 4:l[e].score_abyss=n.score,l[e].status_abyss=t(n),l[e].rank_abyss=s(n)}}for(const e of a){let r=l.findIndex((r=>r.music_id===e.music_id));if(-1===r){const e="Error: 参照データが存在しません。";throw alert(e),Error(e)}switch(e.difficulty_id){case 0:l[r].rating_easy="o";break;case 1:l[r].rating_normal="o";break;case 2:l[r].rating_hard="o";break;case 3:l[r].rating_extreme="o";break;case 4:l[r].rating_abyss="o"}}return l}(function(){try{const e=new XMLHttpRequest;return e.open("GET","https://mypage.musicdiver.jp/api/record_result?lang=ja",!1),e.send(),JSON.parse(e.response).response.play_result_list}catch(e){const r="Error: スコアデータの取得に失敗しました。";throw alert(r),Error(r)}}(),function(){try{const e=new XMLHttpRequest;return e.open("GET","https://mypage.musicdiver.jp/api/music?lang=ja",!1),e.send(),JSON.parse(e.response).response.music_list}catch(e){const r="Error: 楽曲データの取得に失敗しました。";throw alert(r),Error(r)}}(),function(){try{const e=new XMLHttpRequest;return e.open("GET","https://mypage.musicdiver.jp/api/user_rating_music?lang=ja",!1),e.send(),JSON.parse(e.response).response}catch(e){const r="Error: レーティング対象曲データの取得に失敗しました。";throw alert(r),Error(r)}}());!function(r){!function(e){if(0===e.length){const e="Error: 参照データが存在しません。";throw alert(e),Error(e)}}(r),console.info("filename:",e);const t=function(e){const r=Object.keys(e[0]),t=e.map((e=>r.map((r=>e[r]))));let s=[].concat([r],t);console.log(s);let n=function(e){return null==e?"":'"'+(""+e).replace(/"/g,'""')+'"'};return s.map((e=>e.map((e=>n(e))).join(","))).join("\n")}(r);!function(r){const t=new Uint8Array([239,187,191]),s=new Blob([t,r],{type:"text/csv"}),n=(window.URL||window.webkitURL).createObjectURL(s);let a=document.createElement("a");a.download=decodeURI(e),a.href=n,a.type="text/csv",a.click()}(t)}(n)}();
